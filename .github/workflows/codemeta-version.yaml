name: update codemeta version on release
defaults:
  run:
    shell: bash
"on":
  workflow_call:
    inputs:
      release-version:
        description: The released version to write into the codemeta.json file
        required: true
        type: string
permissions:
  contents: write
jobs:
  update:
      runs-on: ubuntu-latest
      if: ${{ inputs.release-version }}
      steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: main
      - name: Set up Git Config
        run: |
          git config user.name "goreleaserbot"
          git config user.email "<bot@goreleaser.com>"
      - name: Update codemeta.json version in main branch
        uses: jossef/action-set-json-field@v2.1
        with:
          file: codemeta.json
          field: version
          value: "${{ inputs.release-version }}"
      - name: Commit updated codemeta.json file
        run: |
          git commit -am "[release] Update codemeta.json version to ${{ inputs.release-version }}"
          git push origin main
