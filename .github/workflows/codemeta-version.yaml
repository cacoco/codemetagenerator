name: update codemeta version on release
defaults:
  run:
    shell: bash
"on":
  workflow_call:
permissions:
  contents: write
jobs:
  update:
      runs-on: ubuntu-latest
      steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Get release version from tag -- saves to current environment context
        run: |
          tag="${{ github.ref_name }}"
          echo "release-version=${tag#v}" >> $GITHUB_ENV
      - name: Set up Git Config
        run: |
          git config user.name "goreleaserbot"
          git config user.email "<bot@goreleaser.com>"
      - name: Update codemeta.json version in main branch
        uses: jossef/action-set-json-field@v2.1
        with:
          file: codemeta.json
          field: version
          value: "${{ env.release-version }}"
      - name: Commit updated codemeta.json file
        run: |
          git switch -c update-codemeta-version
          git commit -am "[release] Update codemeta.json version to ${{ inputs.release-version }}"
          git push origin update-codemeta-version
